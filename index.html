<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Property Lazy Injection by LemuriaNet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Property Lazy Injection</h1>
      <h2 class="project-tagline">IoC属性延迟注入解决思路</h2>
      <a href="https://github.com/LemuriaNet/PropertyLazyInjection" class="btn">View on GitHub</a>
      <a href="https://github.com/LemuriaNet/PropertyLazyInjection/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/LemuriaNet/PropertyLazyInjection/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="延迟注入lazy-injection" class="anchor" href="#%E5%BB%B6%E8%BF%9F%E6%B3%A8%E5%85%A5lazy-injection" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>延迟注入(Lazy Injection)</h2>

<pre><code>在属性注入中，让属性注入的时机发生在我们首次使用属性时
即被注入的属性第一次在使用前都为null来提高性能和节约内存
我把这个方式叫做——"延迟注入(Lazy Injection)"
</code></pre>

<p>在我们的简易IoC Container中，提供了一个特性 InjectionAttribute</p>

<div class="highlight highlight-source-cs"><pre>[AttributeUsage(AttributeTargets.Property , AllowMultiple = <span class="pl-c1">false</span>)]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">InjectionAttribute</span> : <span class="pl-k">Attribute</span>
{
    <span class="pl-k">public</span> <span class="pl-k">bool</span> <span class="pl-en">Lazy</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>

<p>为虚属性标记Injection并把Lazy设置为true来启动延迟注入，例如：</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">FooService</span> : <span class="pl-k">IFooService</span>
{
    [Injection(Lazy = <span class="pl-c1">true</span>)]
    <span class="pl-k">public</span> <span class="pl-k">virtual</span> ILogger <span class="pl-en">Logger</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }

    <span class="pl-k">public</span> <span class="pl-en">FooService</span>()
    {
    }
}</pre></div>

<p>Logger实现ILogger接口，并在构造器中打印"Logger is creating .."</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Logger</span> : <span class="pl-k">ILogger</span>
{
    <span class="pl-k">public</span> <span class="pl-en">Logger</span>()
    {
        Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>Logger is creating ..<span class="pl-pds">"</span></span>);
    }
}</pre></div>

<p>测试代码：</p>

<div class="highlight highlight-source-cs"><pre>[TestMethod]
<span class="pl-k">public</span> <span class="pl-k">void</span> LazyInjection_Test()
{
    Container container = <span class="pl-k">new</span> Container();
    container.Register&lt;ILogger , Logger&gt;();
    container.Register&lt;IFooService , FooService&gt;();
    <span class="pl-k">var</span> foo = container.Resolve&lt;IFooService&gt;();
    Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>IFooService is created<span class="pl-pds">"</span></span>);
    Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>Logger is not create<span class="pl-pds">"</span></span>);
    <span class="pl-k">var</span> logger = foo.Logger;           
    Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>Logger is created<span class="pl-pds">"</span></span>);
    <span class="pl-k">var</span> logger2 = foo.Logger;
}</pre></div>

<p>输出：</p>

<pre><code>IFooService is created
Logger is not create
Logger is creating ..
Logger is created
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/LemuriaNet/PropertyLazyInjection">Property Lazy Injection</a> is maintained by <a href="https://github.com/LemuriaNet">LemuriaNet</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
